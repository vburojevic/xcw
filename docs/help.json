{
  "type": "documentation",
  "version": "0.19.14",
  "purpose": "iOS Simulator log streaming CLI optimized for AI agents. Outputs structured NDJSON for real-time and historical log access.",
  "primary_command": "tail",
  "agent_guidance": "ALWAYS START WITH: xcw tail -s \u003csimulator\u003e -a \u003cbundle_id\u003e. This is THE primary command for monitoring iOS app logs. Run 'xcw list' to get simulator names, and 'xcw apps' to get bundle IDs. Only use other commands (query, watch, analyze) for specific use cases AFTER you've tried tail. The 'query' command reads from macOS system logs and is only useful when you forgot to start tail. Tmux (--tmux) is for human visual monitoring; AI agents should use stdout or --output instead.",
  "quick_start": {
    "analyze_session": "xcw analyze $(xcw sessions show --latest)",
    "check_setup": "xcw doctor",
    "discover_log_sources": "xcw discover -s \"iPhone 17 Pro\" -a com.example.myapp --since 5m",
    "filter_by_expr": "xcw tail -s \"iPhone 17 Pro\" -a com.example.myapp --where '(level=error OR level=fault) AND message~timeout'",
    "filter_by_field": "xcw tail -s \"iPhone 17 Pro\" -a com.example.myapp --where level=error",
    "list_apps": "xcw apps -s \"iPhone 17 Pro\"",
    "list_simulators": "xcw list",
    "machine_friendly": "xcw --machine-friendly tail -s \"iPhone 17 Pro\" -a com.example.myapp",
    "record_to_file": "xcw tail -s \"iPhone 17 Pro\" -a com.example.myapp --session-dir ~/.xcw/sessions",
    "stream_logs": "xcw tail -s \"iPhone 17 Pro\" -a com.example.myapp"
  },
  "commands": {
    "analyze": {
      "description": "Analyze a recorded NDJSON log file",
      "usage": "xcw analyze FILE [flags]",
      "examples": [
        {
          "command": "xcw analyze session.ndjson",
          "description": "Analyze recorded logs"
        }
      ],
      "output_types": [
        "analysis",
        "error"
      ],
      "related_commands": [
        "tail",
        "replay"
      ]
    },
    "apps": {
      "description": "List installed apps on a simulator",
      "usage": "xcw apps -s SIMULATOR [flags]",
      "examples": [
        {
          "command": "xcw apps -s \"iPhone 17 Pro\"",
          "description": "All apps"
        },
        {
          "command": "xcw apps -s \"iPhone 17 Pro\" --user-only",
          "description": "User apps only"
        }
      ],
      "output_types": [
        "app",
        "error"
      ]
    },
    "clear": {
      "description": "Clear a tmux session pane (useful with tail/watch --tmux)",
      "usage": "xcw clear --session SESSION",
      "examples": [
        {
          "command": "xcw clear --session xcw-iphone-17-pro",
          "description": "Clear the tmux pane"
        }
      ],
      "output_types": [
        "info",
        "error"
      ],
      "related_commands": [
        "tail",
        "watch"
      ]
    },
    "completion": {
      "description": "Generate shell completion scripts from the Kong CLI model",
      "usage": "xcw completion [bash|zsh|fish]",
      "examples": [
        {
          "command": "xcw completion zsh \u003e _xcw",
          "description": "Generate zsh completion script"
        },
        {
          "command": "xcw completion bash \u003e xcw.bash",
          "description": "Generate bash completion script"
        }
      ],
      "related_commands": [
        "help",
        "examples"
      ]
    },
    "config": {
      "description": "Show or manage configuration (flags/env/config file precedence)",
      "usage": "xcw config [show|path|generate]",
      "examples": [
        {
          "command": "xcw config",
          "description": "Show effective config (default: show)"
        },
        {
          "command": "xcw config path",
          "description": "Show config file path resolution"
        },
        {
          "command": "xcw config generate",
          "description": "Print a sample config file"
        }
      ],
      "output_types": [
        "config",
        "config_path",
        "error"
      ]
    },
    "discover": {
      "description": "Discover what subsystems, categories, and processes exist in logs. Essential first step for understanding an app's logging landscape.",
      "usage": "xcw discover -s SIMULATOR [-a APP] --since DURATION",
      "examples": [
        {
          "command": "xcw discover -s \"iPhone 17 Pro\" --since 5m",
          "description": "Discover all logs from last 5 minutes"
        },
        {
          "command": "xcw discover -s \"iPhone 17 Pro\" -a com.example.myapp --since 10m",
          "description": "Discover logs for specific app"
        },
        {
          "command": "xcw discover -b --since 1h --top-n 30",
          "description": "More items, booted sim, 1 hour"
        }
      ],
      "output_types": [
        "discovery",
        "error"
      ],
      "related_commands": [
        "tail",
        "query"
      ]
    },
    "doctor": {
      "description": "Check system requirements and configuration",
      "usage": "xcw doctor",
      "examples": [
        {
          "command": "xcw doctor",
          "description": "Run all checks"
        }
      ],
      "output_types": [
        "doctor",
        "error"
      ]
    },
    "examples": {
      "description": "Show usage examples for xcw commands",
      "usage": "xcw examples [command] [flags]",
      "examples": [
        {
          "command": "xcw examples",
          "description": "All examples"
        },
        {
          "command": "xcw examples tail",
          "description": "Tail examples"
        },
        {
          "command": "xcw examples --json",
          "description": "Machine-readable"
        }
      ]
    },
    "handoff": {
      "description": "Emit a compact JSON blob for AI agents (contract hints + versions)",
      "usage": "xcw handoff",
      "examples": [
        {
          "command": "xcw handoff",
          "description": "Agent handoff payload"
        }
      ],
      "output_types": [
        "handoff"
      ],
      "related_commands": [
        "help",
        "schema"
      ]
    },
    "launch": {
      "description": "Launch an app and capture stdout/stderr (print statements). Use this when you need to see print() output that isn't captured by unified logging.",
      "usage": "xcw launch -s SIMULATOR -a APP [flags]",
      "examples": [
        {
          "command": "xcw launch -s \"iPhone 17 Pro\" -a com.example.myapp",
          "description": "Launch and capture stdout/stderr"
        },
        {
          "command": "xcw launch -s \"iPhone 17 Pro\" -a com.example.myapp --terminate-existing",
          "description": "Terminate existing instance first"
        },
        {
          "command": "xcw launch -b -a com.example.myapp",
          "description": "Launch on booted simulator"
        }
      ],
      "output_types": [
        "console",
        "info",
        "error"
      ],
      "related_commands": [
        "tail",
        "apps"
      ]
    },
    "list": {
      "description": "List available iOS Simulators",
      "usage": "xcw list [flags]",
      "examples": [
        {
          "command": "xcw list",
          "description": "All simulators"
        },
        {
          "command": "xcw list --booted-only",
          "description": "Only running simulators"
        }
      ],
      "output_types": [
        "simulator",
        "error"
      ]
    },
    "log-schema": {
      "description": "Output a minimal log schema document for agents",
      "usage": "xcw log-schema",
      "examples": [
        {
          "command": "xcw log-schema",
          "description": "Minimal log schema fields + example"
        }
      ],
      "output_types": [
        "log_schema"
      ],
      "related_commands": [
        "schema",
        "help"
      ]
    },
    "pick": {
      "description": "Interactively pick a simulator or app (prints an ID suitable for scripting)",
      "usage": "xcw pick [simulator|app] [flags]",
      "examples": [
        {
          "command": "xcw pick simulator",
          "description": "Interactively select a simulator (prints UDID)"
        },
        {
          "command": "xcw pick app",
          "description": "Interactively select an app on the booted simulator (prints bundle id)"
        }
      ],
      "output_types": [
        "pick",
        "error"
      ],
      "related_commands": [
        "list",
        "apps"
      ]
    },
    "query": {
      "description": "Query historical logs from iOS Simulator (use -a unless --predicate/--all)",
      "usage": "xcw query -s SIMULATOR [-a APP] --since DURATION [flags]",
      "examples": [
        {
          "command": "xcw query -s \"iPhone 17 Pro\" -a com.example.myapp --since 5m",
          "description": "Last 5 minutes"
        },
        {
          "command": "xcw query -s \"iPhone 17 Pro\" -a com.example.myapp --since 5m -l error",
          "description": "Errors only"
        },
        {
          "command": "xcw query -s \"iPhone 17 Pro\" -a com.example.myapp --since 10m --analyze",
          "description": "With pattern analysis"
        },
        {
          "command": "xcw query -s \"iPhone 17 Pro\" -a com.example.myapp --since 10m --where '(level=error OR level=fault) AND message~timeout'",
          "description": "Where expression"
        },
        {
          "command": "xcw query -s \"iPhone 17 Pro\" -a com.example.myapp --since 5m --dry-run-json",
          "description": "Print resolved query options as JSON and exit"
        }
      ],
      "output_types": [
        "log",
        "analysis",
        "error"
      ],
      "related_commands": [
        "tail",
        "analyze"
      ]
    },
    "replay": {
      "description": "Replay a recorded NDJSON log file with timing",
      "usage": "xcw replay FILE [flags]",
      "examples": [
        {
          "command": "xcw replay session.ndjson",
          "description": "Replay with original timing"
        },
        {
          "command": "xcw replay session.ndjson --speed 2",
          "description": "2x speed"
        }
      ],
      "output_types": [
        "log",
        "error"
      ],
      "related_commands": [
        "analyze",
        "tail"
      ]
    },
    "schema": {
      "description": "Output JSON Schema for xcw output types",
      "usage": "xcw schema [flags]",
      "examples": [
        {
          "command": "xcw schema",
          "description": "Full schema"
        },
        {
          "command": "xcw schema --type log,error",
          "description": "Specific types"
        }
      ]
    },
    "sessions": {
      "description": "Manage session log files",
      "usage": "xcw sessions [list|show|clean]",
      "examples": [
        {
          "command": "xcw sessions list",
          "description": "List recent sessions"
        },
        {
          "command": "xcw sessions show --latest",
          "description": "Path to latest session"
        },
        {
          "command": "xcw sessions clean --keep 10",
          "description": "Keep 10 most recent"
        }
      ],
      "output_types": [
        "session",
        "info",
        "error"
      ]
    },
    "summary": {
      "description": "Summarize recent logs for an app (runs a bounded query and outputs analysis)",
      "usage": "xcw summary -a APP [--window DURATION] [flags]",
      "examples": [
        {
          "command": "xcw summary -a com.example.myapp --window 5m",
          "description": "Analyze the last 5 minutes of logs"
        },
        {
          "command": "xcw summary -s \"iPhone 17 Pro\" -a com.example.myapp --window 30m -p \"error|fatal\"",
          "description": "Analyze last 30 minutes with pattern filter"
        }
      ],
      "output_types": [
        "analysis",
        "error"
      ],
      "related_commands": [
        "query",
        "tail",
        "analyze",
        "discover"
      ]
    },
    "tail": {
      "description": "Stream real-time logs from iOS Simulator (use -a unless --predicate/--all)",
      "usage": "xcw tail -s SIMULATOR [-a APP] [flags]",
      "examples": [
        {
          "command": "xcw tail -s \"iPhone 17 Pro\" -a com.example.myapp",
          "description": "Basic streaming to stdout"
        },
        {
          "command": "xcw tail -s \"iPhone 17 Pro\" -a com.example.myapp --tmux",
          "description": "Background with tmux (returns session name)"
        },
        {
          "command": "xcw tail -s \"iPhone 17 Pro\" -a com.example.myapp --output file.ndjson",
          "description": "Stream to file"
        },
        {
          "command": "xcw tail -s \"iPhone 17 Pro\" -a com.example.myapp --max-duration 5m",
          "description": "Stream for 5 minutes and stop (emits cutoff_reached)"
        },
        {
          "command": "xcw tail -s \"iPhone 17 Pro\" -a com.example.myapp --max-logs 1000",
          "description": "Stop after 1000 logs (emits cutoff_reached)"
        },
        {
          "command": "xcw tail -s \"iPhone 17 Pro\" -a com.example.myapp -l error",
          "description": "Only error/fault level"
        },
        {
          "command": "xcw tail -s \"iPhone 17 Pro\" -a com.example.myapp --filter \"error|warn\"",
          "description": "Filter by regex (alias for --pattern)"
        },
        {
          "command": "xcw tail -s \"iPhone 17 Pro\" -a com.example.myapp --dry-run-json",
          "description": "Print resolved stream options as JSON and exit"
        },
        {
          "command": "xcw tail -s \"iPhone 17 Pro\" -a com.example.myapp --wait-for-launch",
          "description": "Start capture before app launches (emits ready event)"
        },
        {
          "command": "xcw tail -s \"iPhone 17 Pro\" -a com.example.myapp --where level=error",
          "description": "Filter by field/expression (=, !=, ~, !~, \u003e=, \u003c=, ^, $, AND/OR/NOT, parentheses, /regex/i)"
        },
        {
          "command": "xcw tail -s \"iPhone 17 Pro\" -a com.example.myapp --where '(level=error OR level=fault) AND message~timeout'",
          "description": "Boolean where expression"
        },
        {
          "command": "xcw tail -s \"iPhone 17 Pro\" -a com.example.myapp --where \"message~timeout\"",
          "description": "Filter messages containing 'timeout'"
        },
        {
          "command": "xcw tail -s \"iPhone 17 Pro\" -a com.example.myapp --dedupe",
          "description": "Collapse repeated identical messages"
        },
        {
          "command": "xcw tail -s \"iPhone 17 Pro\" -a com.example.myapp --process MyApp --process MyAppExtension",
          "description": "Filter by process name"
        },
        {
          "command": "xcw tail -s \"iPhone 17 Pro\" -a com.example.myapp -x noise -x spam",
          "description": "Exclude multiple patterns"
        },
        {
          "command": "xcw tail -s \"iPhone 17 Pro\" -a com.example.myapp --session-idle 60s",
          "description": "Force a new session boundary after 60s of inactivity"
        },
        {
          "command": "xcw tail -s \"iPhone 17 Pro\" --predicate 'process == \\\"MyApp\\\"'",
          "description": "Stream without -a using a raw predicate (advanced)"
        }
      ],
      "output_types": [
        "log",
        "session_start",
        "session_end",
        "ready",
        "summary",
        "heartbeat",
        "cutoff_reached",
        "tmux",
        "error"
      ],
      "related_commands": [
        "query",
        "watch",
        "analyze",
        "discover"
      ]
    },
    "ui": {
      "description": "Interactive TUI log viewer (for humans; not suitable for agents)",
      "usage": "xcw ui -s SIMULATOR [-a APP] [flags]",
      "examples": [
        {
          "command": "xcw ui -s \"iPhone 17 Pro\" -a com.example.myapp",
          "description": "Open TUI for an app"
        },
        {
          "command": "xcw ui -b -a com.example.myapp",
          "description": "Open TUI on booted simulator"
        }
      ],
      "output_types": [
        "error"
      ],
      "related_commands": [
        "tail",
        "watch"
      ]
    },
    "update": {
      "description": "Show how to upgrade xcw (Homebrew / go install)",
      "usage": "xcw update",
      "examples": [
        {
          "command": "xcw update",
          "description": "Upgrade instructions (NDJSON by default)"
        },
        {
          "command": "xcw -f text update",
          "description": "Human-readable upgrade instructions"
        }
      ],
      "output_types": [
        "update"
      ]
    },
    "version": {
      "description": "Show version information",
      "usage": "xcw version",
      "examples": [
        {
          "command": "xcw version",
          "description": "Print version (NDJSON by default)"
        },
        {
          "command": "xcw -f text version",
          "description": "Human-readable version"
        }
      ],
      "output_types": [
        "version"
      ]
    },
    "watch": {
      "description": "Stream logs like tail, but run trigger commands on errors/faults or message patterns (supports agent-safe cutoffs via --max-duration/--max-logs)",
      "usage": "xcw watch -s SIMULATOR [-a APP] [flags]",
      "examples": [
        {
          "command": "xcw watch -s \"iPhone 17 Pro\" -a com.example.myapp --where level\u003e=error --on-error \"./notify.sh\" --trigger-output capture",
          "description": "Run a command when an error-level log appears"
        },
        {
          "command": "xcw watch -s \"iPhone 17 Pro\" -a com.example.myapp --on-pattern 'crash|fatal:./notify.sh' --cooldown 10s",
          "description": "Run a command when a regex matches the message"
        },
        {
          "command": "xcw watch -s \"iPhone 17 Pro\" -a com.example.myapp --where level\u003e=error --on-error \"./notify.sh\" --max-duration 5m",
          "description": "Watch for 5 minutes and stop"
        },
        {
          "command": "xcw watch -s \"iPhone 17 Pro\" -a com.example.myapp --where level\u003e=error --on-error \"./notify.sh\" --dry-run-json",
          "description": "Print resolved stream options and triggers as JSON and exit"
        }
      ],
      "output_types": [
        "log",
        "trigger",
        "trigger_result",
        "trigger_error",
        "cutoff_reached",
        "tmux",
        "error"
      ],
      "related_commands": [
        "tail",
        "query",
        "discover"
      ]
    }
  },
  "output_types": {
    "analysis": {
      "description": "Pattern analysis of logs",
      "example": {
        "known_pattern_count": 2,
        "new_pattern_count": 1,
        "patterns": [
          {
            "count": 3,
            "is_new": true,
            "pattern": "Connection failed"
          }
        ],
        "schemaVersion": 1,
        "summary": {
          "errorCount": 5,
          "totalCount": 100
        },
        "type": "analysis"
      },
      "when": "When --analyze flag is used with query or analyze command"
    },
    "app": {
      "description": "Installed app information",
      "example": {
        "app_type": "user",
        "bundle_id": "com.example.myapp",
        "name": "MyApp",
        "schemaVersion": 1,
        "type": "app",
        "version": "1.0.0"
      },
      "when": "From xcw apps command"
    },
    "clear_buffer": {
      "description": "Instructs consumers to reset caches at a session boundary (start/end/idle rollover).",
      "example": {
        "reason": "session_start",
        "schemaVersion": 1,
        "session": 2,
        "tail_id": "tail-abc",
        "type": "clear_buffer"
      },
      "when": "Immediately after session_start/session_end/idle rollover in NDJSON mode"
    },
    "config": {
      "description": "Effective configuration and provenance (sources)",
      "example": {
        "config_file": "~/.config/xcw/config.yaml",
        "format": "ndjson",
        "level": "debug",
        "quiet": false,
        "schemaVersion": 1,
        "type": "config",
        "verbose": false
      },
      "when": "From xcw config show (NDJSON mode)"
    },
    "config_path": {
      "description": "Resolved configuration file path (if any)",
      "example": {
        "path": "~/.config/xcw/config.yaml",
        "schemaVersion": 1,
        "type": "config_path"
      },
      "when": "From xcw config path (NDJSON mode)"
    },
    "console": {
      "description": "Console output (stdout/stderr) from xcw launch. Captures print() statements not available via unified logging.",
      "example": {
        "message": "Hello from print()",
        "process": "com.example.myapp",
        "schemaVersion": 1,
        "stream": "stdout",
        "timestamp": "2024-01-15T10:30:45.123Z",
        "type": "console"
      },
      "when": "Each line of stdout/stderr from xcw launch"
    },
    "cutoff_reached": {
      "description": "Emitted when max-duration or max-logs cutoff stops streaming.",
      "example": {
        "reason": "max_duration",
        "schemaVersion": 1,
        "session": 2,
        "tail_id": "tail-abc",
        "total_logs": 500,
        "type": "cutoff_reached"
      },
      "when": "When cutoff thresholds are hit"
    },
    "discovery": {
      "description": "Log discovery results showing subsystems, categories, processes, and levels",
      "example": {
        "app": "com.example.myapp",
        "categories": [
          {
            "count": 300,
            "name": "network"
          }
        ],
        "levels": {
          "debug": 700,
          "error": 80,
          "info": 350
        },
        "processes": [
          {
            "count": 800,
            "name": "MyApp"
          }
        ],
        "schemaVersion": 1,
        "subsystems": [
          {
            "count": 450,
            "levels": {
              "debug": 300,
              "error": 50,
              "info": 100
            },
            "name": "com.example.myapp"
          }
        ],
        "time_range": {
          "end": "2024-01-15T10:30:45Z",
          "start": "2024-01-15T10:25:45Z"
        },
        "total_count": 1250,
        "type": "discovery"
      },
      "when": "From xcw discover command"
    },
    "doctor": {
      "description": "System diagnostic report",
      "example": {
        "all_passed": true,
        "checks": [
          {
            "message": "Xcode 16.0 found",
            "name": "Xcode",
            "status": "ok"
          },
          {
            "message": "1 booted simulator",
            "name": "Simulator",
            "status": "ok"
          }
        ],
        "error_count": 0,
        "schemaVersion": 1,
        "type": "doctor",
        "warn_count": 1
      },
      "when": "From xcw doctor command"
    },
    "error": {
      "description": "Error from xcw (not the app being monitored)",
      "example": {
        "code": "DEVICE_NOT_FOUND",
        "message": "Simulator 'iPhone 99' not found",
        "schemaVersion": 1,
        "type": "error"
      },
      "when": "When xcw encounters an error"
    },
    "gap_detected": {
      "description": "Signals that a gap in the stream was detected (and may be backfilled when --resume is enabled).",
      "example": {
        "from_timestamp": "2024-01-15T10:30:45.123Z",
        "reason": "reconnect",
        "schemaVersion": 1,
        "session": 2,
        "tail_id": "tail-abc",
        "timestamp": "2024-01-15T10:31:00.000Z",
        "to_timestamp": "2024-01-15T10:31:00.000Z",
        "type": "gap_detected",
        "will_fill": true
      },
      "when": "When xcw detects a potential gap and --resume is enabled (NDJSON only)"
    },
    "gap_filled": {
      "description": "Signals that a previously detected gap was backfilled via query.",
      "example": {
        "filled_count": 42,
        "from_timestamp": "2024-01-15T10:30:45.123Z",
        "limit": 5000,
        "reason": "reconnect",
        "schemaVersion": 1,
        "session": 2,
        "tail_id": "tail-abc",
        "timestamp": "2024-01-15T10:31:01.000Z",
        "to_timestamp": "2024-01-15T10:31:00.000Z",
        "type": "gap_filled"
      },
      "when": "After xcw backfills a gap when --resume is enabled (NDJSON only)"
    },
    "handoff": {
      "description": "Compact handoff blob for agents (hints + versions)",
      "example": {
        "contract_version": 1,
        "hints": [
          "ALWAYS START WITH: xcw tail ..."
        ],
        "schemaVersion": 1,
        "timestamp": "2025-12-15T00:00:00Z",
        "type": "handoff",
        "version": "0.19.9"
      },
      "when": "From xcw handoff"
    },
    "heartbeat": {
      "description": "Keepalive message for stream health",
      "example": {
        "contract_version": 1,
        "last_seen_timestamp": "2024-01-15T10:30:44.999Z",
        "latest_session": 2,
        "logs_since_last": 42,
        "schemaVersion": 1,
        "tail_id": "tail-abc",
        "timestamp": "2024-01-15T10:30:45.123Z",
        "type": "heartbeat",
        "uptime_seconds": 300
      },
      "when": "Periodically when --heartbeat is used"
    },
    "info": {
      "description": "Informational message from xcw (non-log event)",
      "example": {
        "message": "Watching logs from iPhone 17 Pro",
        "schemaVersion": 1,
        "simulator": "iPhone 17 Pro",
        "type": "info",
        "udid": "ABC123-DEF456-..."
      },
      "when": "Startup banners and status messages (unless --quiet)"
    },
    "log": {
      "description": "Individual log entry from iOS Simulator. Includes session number for tracking app relaunches.",
      "example": {
        "category": "network",
        "level": "Error",
        "message": "Connection failed: timeout",
        "pid": 1234,
        "process": "MyApp",
        "schemaVersion": 1,
        "session": 1,
        "subsystem": "com.example.myapp",
        "tail_id": "tail-abc",
        "timestamp": "2024-01-15T10:30:45.123Z",
        "type": "log"
      },
      "when": "Each log entry during tail or query"
    },
    "log_schema": {
      "description": "Minimal schema doc for log events (agents)",
      "example": {
        "fields": {
          "level": "Debug|Info|Default|Error|Fault",
          "timestamp": "ISO8601 UTC"
        },
        "schemaVersion": 1,
        "type": "log_schema"
      },
      "when": "From xcw log-schema"
    },
    "metadata": {
      "description": "Tool metadata emitted at start of tail for agents.",
      "example": {
        "commit": "none",
        "contract_version": 1,
        "schemaVersion": 1,
        "type": "metadata",
        "version": "0.10.0"
      },
      "when": "At tail start"
    },
    "pick": {
      "description": "Pick result from xcw pick (simulator/app)",
      "example": {
        "bundle_id": "com.example.myapp",
        "name": "MyApp",
        "picked": "app",
        "schemaVersion": 1,
        "type": "pick"
      },
      "when": "From xcw pick (NDJSON mode)"
    },
    "ready": {
      "description": "Signals that log capture is active and ready. Use with --wait-for-launch to start capturing before the app launches.",
      "example": {
        "app": "com.example.myapp",
        "contract_version": 1,
        "schemaVersion": 1,
        "session": 1,
        "simulator": "iPhone 17 Pro",
        "tail_id": "tail-abc",
        "timestamp": "2024-01-15T10:30:45.123Z",
        "type": "ready",
        "udid": "ABC123-DEF456-..."
      },
      "when": "Immediately after log stream starts when --wait-for-launch is used"
    },
    "reconnect_notice": {
      "description": "Signals that the log stream reconnected; agents should consider potential gaps.",
      "example": {
        "message": "reconnect_notice: reconnecting log stream",
        "schemaVersion": 1,
        "tail_id": "tail-abc",
        "type": "reconnect_notice"
      },
      "when": "After reconnect attempts"
    },
    "session": {
      "description": "Session file information",
      "example": {
        "name": "20241215-103045-com.example.myapp.ndjson",
        "path": "~/.xcw/sessions/20241215-103045-com.example.myapp.ndjson",
        "schemaVersion": 1,
        "size": 12345,
        "timestamp": "2024-12-15T10:30:45Z",
        "type": "session"
      },
      "when": "From xcw sessions list/show commands"
    },
    "session_end": {
      "description": "Emitted when an app session ends (before session_start when app relaunches). Contains summary of the ended session.",
      "example": {
        "pid": 12345,
        "schemaVersion": 1,
        "session": 1,
        "summary": {
          "duration_seconds": 45,
          "errors": 3,
          "faults": 0,
          "total_logs": 142
        },
        "tail_id": "tail-abc",
        "type": "session_end"
      },
      "when": "When xcw tail detects the app was relaunched (before session_start)"
    },
    "session_start": {
      "description": "Emitted when a new app session begins. When alert='APP_RELAUNCHED', the app was relaunched (PID changed). AI agents should watch for this to know logs are from a fresh app instance.",
      "example": {
        "alert": "APP_RELAUNCHED",
        "app": "com.example.myapp",
        "binary_uuid": "C0FFEE-UUID",
        "build": "2201",
        "pid": 67890,
        "previous_pid": 12345,
        "schemaVersion": 1,
        "session": 2,
        "simulator": "iPhone 17 Pro",
        "tail_id": "tail-abc",
        "timestamp": "2024-01-15T10:30:45.123Z",
        "type": "session_start",
        "udid": "ABC123-DEF456-...",
        "version": "1.4.0"
      },
      "when": "When xcw tail detects the app was relaunched (PID changed)"
    },
    "simulator": {
      "description": "Simulator device information",
      "example": {
        "name": "iPhone 17 Pro",
        "runtime": "iOS 18.0",
        "schemaVersion": 1,
        "state": "Booted",
        "type": "simulator",
        "udid": "ABC123-DEF456-..."
      },
      "when": "From xcw list command"
    },
    "stats": {
      "description": "Periodic stream diagnostics emitted alongside heartbeats (useful for detecting reconnects, parse drops, and backpressure)",
      "example": {
        "buffered": 10,
        "channel_drops": 0,
        "last_seen_timestamp": "2024-01-15T10:30:44.999Z",
        "parse_drops": 0,
        "reconnects": 1,
        "schemaVersion": 1,
        "session": 2,
        "tail_id": "tail-abc",
        "timestamp": "2024-01-15T10:30:45.123Z",
        "timestamp_parse_drops": 0,
        "type": "stats"
      },
      "when": "Periodically alongside heartbeat output (tail only)"
    },
    "summary": {
      "description": "Log statistics summary",
      "example": {
        "errorCount": 3,
        "errorRate": 1.2,
        "faultCount": 0,
        "hasErrors": true,
        "hasFaults": false,
        "schemaVersion": 1,
        "tail_id": "tail-abc",
        "totalCount": 142,
        "type": "summary"
      },
      "when": "At end of tail, with --summary-interval, or in analysis"
    },
    "tmux": {
      "description": "Tmux session information when --tmux is used",
      "example": {
        "attach": "tmux attach -t xcw-iphone-17-pro",
        "schemaVersion": 1,
        "session": "xcw-iphone-17-pro",
        "type": "tmux"
      },
      "when": "Immediately when xcw tail --tmux is called"
    },
    "trigger": {
      "description": "Emitted when a watch trigger starts running",
      "example": {
        "command": "notify.sh",
        "message": "Connection failed: timeout",
        "schemaVersion": 1,
        "session": 1,
        "tail_id": "tail-abc",
        "timestamp": "2024-01-15T10:30:45.123Z",
        "trigger": "error",
        "trigger_id": "trigger-xyz",
        "type": "trigger"
      },
      "when": "When xcw watch starts a trigger command"
    },
    "trigger_error": {
      "description": "Emitted when a watch trigger fails to execute or exits non-zero",
      "example": {
        "command": "notify.sh",
        "error": "exit status 1",
        "schemaVersion": 1,
        "session": 1,
        "tail_id": "tail-abc",
        "timestamp": "2024-01-15T10:30:45.456Z",
        "trigger": "error",
        "trigger_id": "trigger-xyz",
        "type": "trigger_error"
      },
      "when": "After a watch trigger command fails"
    },
    "trigger_result": {
      "description": "Emitted when a watch trigger completes (exit code, duration, optional output)",
      "example": {
        "command": "notify.sh",
        "duration_ms": 120,
        "exit_code": 0,
        "output": "ok",
        "schemaVersion": 1,
        "session": 1,
        "tail_id": "tail-abc",
        "timestamp": "2024-01-15T10:30:45.456Z",
        "trigger": "error",
        "trigger_id": "trigger-xyz",
        "type": "trigger_result"
      },
      "when": "After a watch trigger command exits"
    },
    "update": {
      "description": "xcw upgrade instructions",
      "example": {
        "commit": "none",
        "current_version": "0.19.9",
        "go_install": "go install github.com/vburojevic/xcw/cmd/xcw@latest",
        "homebrew": "brew update \u0026\u0026 brew upgrade xcw",
        "releases_url": "https://github.com/vburojevic/xcw/releases",
        "schemaVersion": 1,
        "type": "update"
      },
      "when": "From xcw update (NDJSON mode)"
    },
    "version": {
      "description": "xcw version information",
      "example": {
        "commit": "none",
        "type": "version",
        "version": "0.19.9"
      },
      "when": "From xcw version"
    },
    "warning": {
      "description": "Warning from xcw (non-fatal)",
      "example": {
        "message": "reconnect_notice: reconnecting log stream",
        "schemaVersion": 1,
        "type": "warning"
      },
      "when": "Non-fatal issues (eg. reconnects, trigger skips, diagnostic warnings)"
    }
  },
  "error_codes": {
    "DEVICE_NOT_FOUND": {
      "description": "Simulator not found by name or UDID",
      "recovery": "Run 'xcw list' to see available simulators"
    },
    "FILE_NOT_FOUND": {
      "description": "Input file not found",
      "recovery": "Check file path exists"
    },
    "FILTER_REQUIRED": {
      "description": "No source filter provided (refusing to run unfiltered by default)",
      "recovery": "Provide -a/--app or --predicate, or pass --all to intentionally stream/query all logs"
    },
    "INVALID_DURATION": {
      "description": "Duration parsing failed",
      "recovery": "Use format like '5m', '1h', '30s'"
    },
    "INVALID_FILTER": {
      "description": "Filter parsing/compilation failed",
      "recovery": "Check regex/--where syntax; quote complex expressions"
    },
    "INVALID_FLAGS": {
      "description": "--simulator and --booted used together",
      "recovery": "Use only one of --simulator or --booted"
    },
    "INVALID_PATTERN": {
      "description": "Regex pattern compilation failed",
      "recovery": "Check regex syntax"
    },
    "LIST_APPS_FAILED": {
      "description": "Failed to list apps",
      "recovery": "Check simulator is booted"
    },
    "NO_BOOTED_SIMULATOR": {
      "description": "No booted simulator when --booted used",
      "recovery": "Boot a simulator in Xcode or use 'xcrun simctl boot'"
    },
    "QUERY_FAILED": {
      "description": "Historical log query failed",
      "recovery": "Check simulator is running"
    },
    "STREAM_FAILED": {
      "description": "Log streaming failed",
      "recovery": "Check simulator is running and accessible"
    },
    "TMUX_ERROR": {
      "description": "tmux operation failed",
      "recovery": "Check tmux is working: 'tmux list-sessions'"
    },
    "TMUX_NOT_INSTALLED": {
      "description": "tmux not installed",
      "recovery": "Install with 'brew install tmux'"
    },
    "TUI_FAILED": {
      "description": "TUI exited with an error",
      "recovery": "Rerun with -v for debug output or use 'xcw tail' for non-interactive streaming"
    }
  },
  "workflows": [
    {
      "name": "codex_streaming",
      "description": "Real-time log streaming for Codex/script-based agents",
      "when": "Agent processes stdout line by line, reacting immediately to errors",
      "steps": [
        "xcw tail -s \"iPhone 17 Pro\" -a com.example.myapp",
        "# Agent reads NDJSON lines from stdout",
        "# Each line is a complete JSON object to parse"
      ]
    },
    {
      "name": "claude_code_background",
      "description": "Background monitoring for Claude Code with on-demand queries",
      "when": "Long-running session where agent does other work while logs stream",
      "steps": [
        "xcw tail -s \"iPhone 17 Pro\" -a com.example.myapp --tmux",
        "# Returns tmux session info immediately",
        "# Agent continues with other work...",
        "xcw query -s \"iPhone 17 Pro\" -a com.example.myapp --since 5m -l error",
        "# Query errors when needed"
      ]
    },
    {
      "name": "test_run_capture",
      "description": "Capture logs during test run for analysis",
      "when": "Need persistent log record for replay or sharing",
      "steps": [
        "xcw tail -s \"iPhone 17 Pro\" -a com.example.myapp --output test-run.ndjson",
        "# Run tests...",
        "# Stop with Ctrl+C",
        "xcw analyze test-run.ndjson"
      ]
    }
  ],
  "contract": [
    "use latest session only",
    "match tail_id to current tail invocation",
    "reset caches on clear_buffer/session_start/session_end",
    "use newest rotated file unless comparing runs"
  ]
}
